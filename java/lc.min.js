(function($){$.widget("ui.listCtl",{_init:function(){var t=this;this.options.selectionMode="stay",this.options.parent=t.element,this.options.parentId=this.options.parent.attr("id"),this.options.selectedItem=null,this.options.checkString="<div class='checkDiv'><input type='checkbox' class='checkbox' tabindex='-1'/></div>",this.options.pageControlString="<div class='listPage'><a id='"+this.options.parentId+"_Previous' href='#' class='floatLeft pageBack'>"+this.options.resPrev+"</a><a id='"+this.options.parentId+"_Next' href='#' class='floatRight pageNext'>"+this.options.resNext+"</a></div>",this.options.SM_STAY="stay",this.options.SM_REMOVE="remove",this.options.PG_NEXT="next",this.options.PG_BACK="back",this.options.RIGHT_BUTTON=2,this.options.selectAllFlag=!1,this.options.container=t.element.parent(),this.options.parent.hasFocus=!1,this.options.parent.focusAquired=!1,this.options.parent.attr("tabindex","0"),this.options.pagingActivated=!1,this.options.items=this.options.parent.children(),this.element.addClass("listCtl"),this.options.container.addClass("listCtl-container"),this.options.items.length>0?(this.options.items.each(function(i){this.index=i,this.jObject=$(this),this.jObject.attr("tabindex",0),t.options.pagable&&this.jObject.hide()}),this.options.pagable=!1):null!=this.options.dataList&&this.addDataList(this.options.dataList,!0),this.options.pagable&&(-1==this.options.pageSize&&(this.options.pageSize=this.options.items.length),this.options.currentPagePointer=0,this.options.currentPageNumber=0,this.options.pagingActivated=!0,this.options.container.append(this.options.pageControlString),this.options.backButton=this.options.container.find(".pageBack"),this.options.nextButton=this.options.container.find(".pageNext"),this.options.backButton.click(function(i){t._pageBack_Click(i)}),this.options.nextButton.click(function(i){t._pageNext_Click(i)}),this.options.backButton.hide(),this.options.nextButton.hide(),null!=this.options.dataList&&this.options.dataList.length>0&&this._refreshPage()),this._handleItemCountChange(),this.options.selectionMode=this.options.selectionMode.toLowerCase(),this.options.selectionMode!=this.options.SM_STAY&&this.options.selectionMode!=this.options.SM_REMOVE&&(this.options.selectionMode=this.options.SM_STAY),this.options.checkable&&(this.options.multiSelect=!0,$.each(this.options.items,function(i,e){var s=e.jObject;s.prepend(t.options.checkString),s.find(":checkbox").attr("id","chk"+i)})),this.options.multiSelect&&(this.options.selectionMode=this.options.SM_STAY,this.options.selectedItems=[]),this.options.inhibitClick&&this.options.items.click(function(i){t._item_Click(i,this)}),this.options.items.mouseup(function(i){t._item_RightClick(i,this)}),this.options.doubleClick&&this.options.items.dblclick(function(i){t._item_DblClick(i,this)}),this.options.parent.keyup(function(i){i.preventDefault(),t.options.hover&&t.options.items.removeClass("ui-enter");var e,s=t.options.selectedItem,n=!1;if(null!=s)switch(i.which){case 38:e=s.prev();break;case 40:e=s.next();break;case 13:e=s,n=!0;break;case 9:var o=i.shiftKey?t.options.container.prev():t.options.container.next();o.focus();break;case 32:t.options.handleSpace&&t._raiseEvent("spcClick",i,{item:s})}else if(9==i.which){var o=i.shiftKey?t.options.container.prev():t.options.container.next();o.focus()}else t.options.items.length>0&&(e=t.options.items[0].jObject);null!=e&&(0==e.length&&(e=s),t.options.pagable&&e.is(":hidden")||(e.focus(),t._selectItem(e,i,!1,n,!0)))}),this.options.parent.focus(function(){null!=t.options.parent&&(t.options.parent.hasFocus=!0,t.options.parent.focusAquired||null==t.options.selectedItem||(t.options.parent.focusAquired=!0,t.options.selectedItem.focus()))}),this.options.parent.blur(function(){null!=t.options.parent&&(t.options.parent.hasFocus=!1,t.options.parent.focusAquired=!1)}),this.options.hover&&(this.options.items.mouseenter(function(i){t._item_hover(i,this)}),this.options.items.mouseleave(function(i){t._item_mouseOut(i,this)})),this.selectItemByIndex(this.options.selectedId)},_pageBack_Click:function(t){t.preventDefault(),this._showPage(this.options.PG_BACK);var i=this.options.currentPagePointer/this.options.pageSize,e=this.options.dataList.length/this.options.pageSize,s=this.options.dataList.length%this.options.pageSize;0!=s&&(e=(this.options.dataList.length-s)/this.options.pageSize+1),this._raiseEvent("prevClicked",t,{currentPage:i,totalPages:e})},_pageNext_Click:function(t){t.preventDefault(),this._showPage(this.options.PG_NEXT);var i=this.options.currentPagePointer/this.options.pageSize,e=this.options.dataList.length/this.options.pageSize,s=this.options.dataList.length%this.options.pageSize;0!=s&&(e=(this.options.dataList.length-s)/this.options.pageSize+1),this._raiseEvent("nextClicked",t,{currentPage:i,totalPages:e})},_item_DblClick:function(t,i){t.preventDefault();var e=$(i);this._raiseEvent("dblClicked",t,{item:e})},_item_Click:function(t,i){$.nodeName(t.target,"input")||t.preventDefault();var e=$(i);this._selectItem(e,t,!0,!0)},_item_RightClick:function(t,i){if(t.button==this.options.RIGHT_BUTTON){$.nodeName(t.target,"input")||t.preventDefault();var e=$(i);this._rightClicked(e,t)}},_item_hover:function(t,i){t.preventDefault();var e=$(i);if(this.options.selectionMode!=this.options.SM_STAY||this.options.multiSelect)if(this.options.multiSelect){var s=this.options.selectedItems.indexOfCustom(e);-1==s&&e.removeClass("ui-selected ui-enter").addClass("ui-enter").siblings().removeClass("ui-enter")}else e.addClass("ui-enter").siblings().removeClass("ui-enter");else(null==this.options.selectedItem||e.attr("index")!=this.options.selectedItem.attr("index"))&&e.removeClass("ui-selected ui-enter").addClass("ui-enter").siblings().removeClass("ui-enter");return!1},_item_mouseOut:function(t,i){t.preventDefault();var e=$(i);return e.removeClass("ui-enter"),!1},destroy:function(){this.options.pagable&&(this.options.currentPagePointer=0,this.options.currentPageNumber=0,this.options.pagingActivated=!1,this.options.backButton.unbind("click"),this.options.nextButton.unbind("click")),null!=this.options.container&&(this.options.container.find("listPage").remove(),this.options.container=null),null!=this.options.dataList&&($(this.options.dataList).remove(),this.options.dataList=null),this.options.items.unbind("click"),this.options.parent.unbind("keyup").unbind("focus").unbind("blur"),this.deleteAll(!0),this.options.parent=null,this.options.container=null,this.element.removeClass("listCtl"),$.widget.prototype.destroy.apply(this,arguments)},isOnFirstPage:function(){return this.options.pagable&&null!=this.options.dataList&&this.options.dataList.length>0?this.options.currentPagePointer==this.options.pageSize:!0},_showPage:function(t){if(this.options.pagable&&null!=this.options.dataList&&this.options.dataList.length>0){var i=this.options.currentPagePointer,e=this.options.pageSize,s=this._isValidMove(t,i);if(s)if(t==this.options.PG_NEXT){var n=this.options.dataList.length-i,o=0;n>e&&(o=e),this._refreshPage(),this.options.currentPagePointer=i+o,this.options.currentPageNumber++}else{var o=0;i-e>=0&&(o=e),this.options.currentPagePointer=this.options.items[0].dataObject._PosIndex-o,this._refreshPage(),this.options.currentPageNumber--,this.options.currentPagePointer=0!=this.options.currentPagePointer?i-o:e}this._handlePageButtonState(this.options.currentPagePointer)}},_isValidMove:function(t,i){return this.options.pagable&&null!=this.options.dataList&&this.options.dataList.length>0?t==this.options.PG_NEXT?this.options.dataList.length-i>0:i>=this.options.pageSize:!1},_handlePageButtonState:function(){if(this.options.pagable){if(0==this.options.items.length||null==this.options.dataList||0==this.options.dataList.length)return this.options.nextButton.hide(),this.options.backButton.hide(),void 0;null!=this.options.items[this.options.items.length-1].dataObject._PosIndex&&this.options.items[this.options.items.length-1].dataObject._PosIndex!=this.options.dataList.length-1?this.options.nextButton.show():this.options.nextButton.hide(),null!=this.options.items[0].dataObject._PosIndex&&0!=this.options.items[0].dataObject._PosIndex?this.options.backButton.show():this.options.backButton.hide()}},_refreshPage:function(t){if(this.options.pagable&&null!=this.options.dataList){var i=this.options.currentPagePointer,e=0;if(this.deleteAll(!1),this.options.dataList.length>0){t&&(0>=i-this.options.pageSize?i=0:i-=this.options.pageSize),e=i+this.options.pageSize<=this.options.dataList.length?this.options.pageSize:this.options.dataList.length-i;for(var s=0,n=i;i+e>n;n++){var o=this.options.dataList[n],a=this.options.formatItem(s,o);null!=a?(o._PosIndex=n,this.addItem(a,s,o),s++):o._isCorrupt=!0}}this._handlePageButtonState(i)}},_resetPosIndex:function(){if(this.options.pagable&&null!=this.options.dataList){var t=this.options.currentPagePointer,i=0;if(this.options.dataList.length>0){0>t-this.options.pageSize?t=0:0==t-this.options.pageSize?t=this.options.pageSize:t-=this.options.pageSize,i=t+this.options.pageSize<=this.options.dataList.length?this.options.pageSize:this.options.dataList.length-t;for(var e=t;t+i>e;e++){var s=this.options.dataList[e];s._isCorrupt||(s._PosIndex=e)}}}},_adjustCurrentPointer:function(t,i){i&&this.options.currentPagePointer+this.options.pageSize>t&&(this.options.currentPagePointer==this.options.dataList.length&&(this.options.currentPagePointer=this.options.currentPagePointer-this.options.pageSize,this.options.currentPageNumber--),this.options.currentPagePointer==this.options.pageSize&&(this.options.currentPageNumber=1))},_showPageForItem:function(t){if(null!=item&&this.options.pagable){t=Number(t);var i=Math.floor(t/this.options.pageSize);this.options.currentPagePointer=i*this.options.pageSize,this._refreshPage()}},_selectItem:function(t,i,e,s,n){null==s&&(s=!1),null==e&&(e=this.options.autoSelect),null==n&&(n=!1);var o=t.hasClass("ui-selected");if(null!=t){if(this.options.multiSelect){n?(s&&(t.removeClass("ui-enter").toggleClass("ui-selected"),o=t.hasClass("ui-selected")),!o&&this.options.hover&&t.removeClass("ui-selected ui-enter").addClass("ui-enter").siblings().removeClass("ui-enter")):(t.removeClass("ui-enter").toggleClass("ui-selected"),o=t.hasClass("ui-selected"),!o&&this.options.hover&&t.addClass("ui-enter").siblings().removeClass("ui-enter"));var a=this.options.selectedItems.indexOfCustom(t);if(o){var h=-1;h=-1!=a?a:this.options.selectedItems.length,this.options.selectedItems[h]=t}else-1!=a&&this.options.selectedItems.splice(a,1);if(this.options.checkable&&s){var l=t.find(":checkbox");l.attr("checked"),l.attr("checked",o)}}else t.removeClass("ui-selected ui-enter").addClass("ui-selected"),t.siblings().removeClass("ui-selected");if(this.options.selectedItem=t,this._raiseEvent("highlighted",i,{item:t}),(s||e&&this.options.autoSelect)&&this._raiseEvent("selected",i,{item:t,isKeyboard:n,isClicked:s}),this.options.selectionMode==this.options.SM_REMOVE){var p=this;setTimeout(function(){t.removeClass("ui-selected"),p.options.selectedItem=null,p.options.hover&&s&&t.addClass("ui-enter").siblings().removeClass("ui-enter")},100)}}},_rightClicked:function(t,i){this._raiseEvent("rightClick",i,{item:t})},_raiseEvent:function(t,i,e){e.tagData=this.options.tagData,e.selectAll=this.options.selectAllFlag,e.listObject=this.options.parent,e.selectedCount=this.options.multiSelect?null!=this.options.selectedItems?this.options.selectedItems.length:0:null!=this.options.selectedItem?this.options.selectedItem.length:0,e.itemCount=this.options.items.length,this._trigger(t,i,e)},_handleItemCountChange:function(){var t=!1;this.options.hideIfEmpty&&(this.options.items.length>0?this.options.container.show():this.options.container.hide(),t=this.options.items.length>0),this._raiseEvent("itemcountchanged",new jQuery.Event,{hideState:t})},_resetPaging:function(){this.options.pagable&&(this.options.currentPagePointer=0,this.options.currentPageNumber=0,this._showPage(this.options.PG_NEXT))},selectDataItemByAttr:function(attrib,val){var self=this;null!=this.options.dataList&&$(this.options.dataList).each(function(index,data){eval("data."+attrib)==val&&self.selectDataItemByIndex(index)})},selectDataItemByIndex:function(t){if(this.options.pagable){this._showPageForItem(t);var i=this.options.items[t-this.options.currentPagePointer];null!=i&&$(i).click()}else this.selectItemByIndex(t)},highlightDataItemByAttr:function(attrib,val){var self=this;null!=this.options.dataList&&$(this.options.dataList).each(function(index,data){eval("data."+attrib)==val&&self.highlightDataItemByIndex(index)})},highlightDataItemByIndex:function(t){if(this.options.pagable){this._showPageForItem(t);var i=this.options.items[t-this.options.currentPagePointer];null!=i&&this._selectItem($(i),new $.Event,!0,!1,!1)}else this.selectItemByIndex(t)},selectItem:function(t){if(null!=t){var i=$(t);i.click()}},selectItemByAttr:function(t,i){var e;this.options.items.each(function(s,n){return n.jObject.attr(t)===i?(e=n.index,!1):void 0}),null!=e&&this.selectItemByIndex(e)},selectItemByIndex:function(t){t>=0&&this.options.items.length>t&&this.selectItem(this.options.items[t])},itemCount:function(){return this.options.items.length},selectedItems:function(){if(this.options.multiSelect)return this.options.selectedItems;var t=[];return null!=this.options.selectedItem&&(t[0]=this.options.selectedItem),t},toggleSelectAll:function(t){if(this.options.multiSelect){var i=this;this.options.selectAllFlag=!0,this.options.selectedItems=[],$.each(this.options.items,function(e,s){var n=$(s);t?n.hasClass("ui-selected")||(n.addClass("ui-selected").find(":checkbox").attr("checked",t),i.options.selectedItems[e]=n):n.hasClass("ui-selected")&&n.removeClass("ui-selected").find(":checkbox").attr("checked",t)}),!t&&this.options.hover&&this.options.items.removeClass("ui-enter"),this._raiseEvent("selectAll",event,{state:t}),this.options.selectAllFlag=!1}},refreshCurrentPage:function(){this.options.pagable&&this._refreshPage()},replaceDataItem:function(t,i,e){if(null!=i&&null!=t&&null!=this.options.dataList&&0!=this.options.dataList.length)if(null==e&&(e=!0),this.options.dataList[item.index]=i,this.options.pagable)e&&this.options.currentPagePointer+this.options.pageSize>t&&this._refreshPage(),this._handlePageButtonState(this.options.currentPagePointer);else{var s=this.options.formatItem(t,i);null!=s&&(this.deleteItem(t),this.addItem(s,t,i))}},addDataList:function(t,i){if(null!=t){var e=this,s=$(t);i?(this.deleteAllData(!1),this.options.pagable?(this.options.dataList=t,this._resetPaging()):s.each(function(t,i){e.addDataItem(null,i)}),this.reset(!1)):(null==this.options.dataList&&(this.options.dataList=[]),this.options.pagable?0==this.options.dataList.length?(this.options.dataList=t,this._resetPaging()):this.options.dataList.length-this.options.currentPagePointer<this.options.pageSize?(this.options.dataList=this.options.dataList.concat(t),this._refreshPage(),this._handlePageButtonState(this.options.currentPagePointer)):(this.options.dataList=this.options.dataList.concat(t),this._handlePageButtonState(this.options.currentPagePointer)):s.each(function(t,i){e.addDataItem(null,i)}))}},addDataItem:function(t,i,e){if(null!=i)if(null==this.options.dataList&&(this.options.dataList=[]),null==t&&(t=this.options.items.length),null==e&&(e=!0),this.options.pagable)e&&this.options.currentPagePointer+this.options.pageSize>t?(this.options.dataList.insertAt(i,t),this._refreshPage(!0)):(this.options.dataList.insertAt(i,t),this._resetPosIndex()),this._handlePageButtonState(this.options.currentPagePointer);else{var s=this.options.formatItem(t,i);null!=s&&(this.options.dataList.insertAt(i,t),this.addItem(s,t,i))}},addItem:function(t,i,e,s){var n=!1;if(null==i)i=this.options.items.length,n=!0;else{if(i=isNaN(Number(i))?this.options.items.length:Number(i),0>i||i>this.options.items.length)return;n=i==this.options.items.length}var o=this,a=$(t);this.options.checkable&&(a.prepend(this.options.checkString),a.find(":checkbox").attr("id","chk"+i)),0==this.element.children().length?this.options.parent.append(a[0]):i>0?this.element.children().eq(i-1).after(a[0]):0==i&&this.element.children().eq(i).before(a[0]),a=this.element.children().eq(i);var h=a[0];h.index=i,h.jObject=a,h.dataObject=e,h.jObject.attr("tabindex",0),n?this.options.items.push(h):this.options.items.insertAt(h,i);for(var l=i;this.options.items.length>l;l++)this.options.items[l].index=l;this.options.doubleClick&&a.dblclick(function(t){o._item_DblClick(t,this)}),this.options.inhibitClick&&a.click(function(t){o._item_Click(t,this)}),a.mouseup(function(t){o._item_RightClick(t,this)}),this.options.hover&&(a.mouseenter(function(t){o._item_hover(t,this)}),a.mouseleave(function(t){o._item_mouseOut(t,this)})),this._handleItemCountChange(i,!0),this.options.autoSelect&&s&&this.selectItem(h)},deleteDataItems:function(list,attrib){if(null!=list&&null!=attrib&&""!=attrib){var self=this;this.options.pagable?($(list).each(function(index,data){var val=eval("data."+attrib);self.deleteDataItemByAttr(attrib,val,!1)}),this._resetPaging()):$(list).each(function(index,data){var val=eval("data."+attrib),item=self.getDataItemByAttr(attrib,val);null!=item&&(self.options.dataList.splice(item.index,1),self.deleteItem(item.index))})}},deleteDataItem:function(t,i){null==this.options.dataList||0>t||t>=this.options.dataList.length||(null==i&&(i=!0),this.options.pagable?(this.options.dataList.splice(t,1),null!=this.options.selectedItem&&this.options.selectedItem.attr("index")==t&&(this.options.selectedItem=null),this._adjustCurrentPointer(t,!0),i&&this.options.currentPagePointer+this.options.pageSize>t&&this._refreshPage(!0)):(this.options.dataList.splice(t,1),this.deleteItem(t)))},deleteDataItemByAttr:function(attrib,val,isRefresh){var self=this;null!=this.options.dataList&&$(this.options.dataList).each(function(index,data){eval("data."+attrib)==val&&self.deleteDataItem(index,isRefresh)})},deleteItem:function(t){if(!(0>t||t>=this.options.items.length)){var i=this.options.items[t],e=i.jObject,s=e.hasClass("ui-selected"),n=this.selectedItems();if(e){if(e.unbind("click"),this.options.hover&&e.unbind("mouseenter").unbind("mouseleave"),this.options.multiSelect){var o=this.options.selectedItems.indexOfCustom(e);-1!=o&&this.options.selectedItems.splice(o,1)}null!=this.options.selectedItem&&this.options.selectedItem[0]==i&&(this.options.selectedItem=null),this.options.items.splice(t,1),this.element.children().eq(i.index).remove();for(var a=t;this.options.items.length>a;a++)this.options.items[a].index=a;if(this._handleItemCountChange(t,!1),this.options.autoSelect&&n.length>0&&s){var h=null,l=null;this.options.items.length>t?(h=this.options.items[t],l=null!=h?h.jObject:null):0!=this.options.items.length&&(h=this.options.items[--t],l=null!=h?h.jObject:null),null!=l&&l.click()}}}},deleteItemByAttr:function(t,i){var e;this.options.items.each(function(s,n){return n.jObject.attr(t)===i?(e=n.index,!1):void 0}),null!=e&&this.deleteItem(e)},deleteAll:function(t){this.element.children().remove(),this.options.items=$([]),this._handleItemCountChange(0,!1),t&&this.reset()},deleteAllData:function(t){this.options.dataList=$([]),this.deleteAll(t),this._handlePageButtonState(this.options.currentPagePointer)},getAllItems:function(){return this.options.items},getAllDataItems:function(){return this.options.dataList},getItemByAttr:function(t,i){var e;return this.options.items.each(function(s,n){return n.jObject.attr(t)===i?(e=n,!1):void 0}),e},getItemByIndex:function(t){var i=null;return this.options.items.length>t&&(i=$(this.options.items[t])),i},getDataItemByAttr:function(attrib,val){var retItem;return null!=this.options.dataList&&$(this.options.dataList).each(function(i,data){return eval("data."+attrib)===val?(retItem={index:i,data:data},!1):void 0}),retItem},isOnFirstPage:function(){return 1>=this.options.currentPageNumber},isItemSelected:function(t){if(null!=t&&this.options.items.length>t){var i=this.options.items[t];return $(i).hasClass("ui-selected")}return!1},reset:function(t){null==t&&(t=this.options.pagable),this.options.items.removeClass("ui-selected ui-enter"),this.options.selectedItem=null,this.options.selectedItems=[],this.options.selectAllFlag=!1,t&&this._resetPaging()}}),$.extend($.ui.listCtl,{defaults:{selectedId:-1,handleSpace:!1,autoSelect:!0,doubleClick:!1,inhibitClick:!0,hideIfEmpty:!1,selectionMode:"stay",hover:!1,tagData:null,checkable:!1,multiSelect:!1,pagable:!1,pageSize:-1,dataList:null,resNext:"Next",resPrev:"Previous"},getter:"itemCount, selectedItems, getAllItems, getItemByAttr getDataItemByAttr getAllDataItems isItemSelected isOnFirstPage getItemByIndex"})})(jQuery);